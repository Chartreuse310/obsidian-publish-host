import {parseMarkdown} from "./src/backend/parser/index.ts";

const cache: Record<string, any> = {}

function iterateDir(dir: string, cache: Record<string, any>) {
    const items = Deno.readDirSync(dir)
    for (const item of items) {
        const name = `${dir}/${item.name}`
        if (item.isFile) {
            const key = name.replace(/^vault\//, '')
            if (name.endsWith('.md')) {
                cache[key] = parseMarkdown(Deno.readTextFileSync(name))
            } else {
                cache[key] = null
            }
        } else if (item.isDirectory) {
            iterateDir(name, cache)
        }
    }
}

iterateDir('vault', cache)

const banner = '// This file is automatically generated, do not modify it manually.\n\n'
const cacheFileContent = `${banner}export default ${JSON.stringify(cache)}`
Deno.writeTextFileSync('src/backend/cache.ts', cacheFileContent)

const msg = `
âœ…  cache æ•°æ®å·²ç”Ÿæˆï¼Œç°åœ¨å¯ä»¥æäº¤å‘å¸ƒå•¦ï¼ğŸ‰ğŸ‰ğŸ‰ 

å¯è¿è¡Œä»¥ä¸‹å‘½ä»¤åœ¨æœ¬åœ°é¢„è§ˆï¼š
    $ deno task dev
æˆ–
    $ npm run dev
`
console.log(msg)
